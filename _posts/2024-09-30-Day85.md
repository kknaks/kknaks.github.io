---
layout: post
toc: true
toc_sticky: true

title:  "Day85 실습프로젝트(NCP)"
summary: "실습프로젝트(NCP)"
author: 이건학
date: '2024-09-30 1:35:23 +0900'
category: ['bitcamp']
tags: bitcamp, web, JAVA
thumbnail: /assets/img/posts/class_thumbnail/Day85.png
keywords: 
usemathjax: false
permalink: /blog/Day85/
---

# User 프로필 만들기
## 1. upload
### 1) form.jsp 수정
- `form.jsp`에서 유저 프로필을 등록할 HTML을 작성한다.

    ```typescript
    //encording type을 multipartfh 수정한다.
    <form action='add' method="post" enctype="multipart/form-data">
  
    //첨부파일을 받을 file타입을 선언한다. 
      첨부파일: <input name="files" type="file" multiple><br>
    ```

### 2) User 클래스 수정
- user의 프로필을 파일명을 저장할 String 변수를 추가한다. 

    ```java
    //파일명을 저장할 String
    private String photo;
    
    //Setter Getter 추가
    public String getPhoto() {
      return photo;
    }
    
    public void setPhoto(String photo) {
      this.photo = photo;
    }
    ```

### 3) sql table 생성 및 Mapper 수정
- 객체에 저장한 String photo를 sql의 서버에 저장한다. 

  ```mysql
  alter table myapp_users
      add column photo varchar(100);
  ```

- `UserDaoMapper.xml`파일에서 UserMap과 insert를 수정한다. 

  ```xml
  <resultMap id="UserMap" type="user">
      <result column="photo" property="photo"/>
  </resultMap>
  
  <insert id="insert" parameterType="user">
    insert into myapp_users(name, email, pwd, tel, photo)
    values (#{name}, #{email}, sha1(#{password}), #{tel}, #{photo})
  </insert>
  ```

### 4) userController.add() 수정
- `userController.add`에서 HTTP에서 보낸 파일데이터를 받아 inputStream과 contentType을 설정한다.

```java
@PostMapping("/user/add")
public String add(User user, MultipartFile file) throws Exception {

    // 클라이언트가 보낸 파일을 저장할 때 다른 파일 이름과 충돌나지 않도록 임의의 새 파일 이름을 생성한다.
    String filename = UUID.randomUUID().toString();

    HashMap<String, Object> options = new HashMap<>();
    options.put(StorageService.CONTENT_TYPE, file.getContentType());
    storageService.upload(folderName + filename,
            file.getInputStream(),
            options);

    user.setPhoto(filename); // DB에 저장할 사진 파일 이름 설정

    userService.add(user);
    return "redirect:list";
}
```

## 2. View
### 1) view.jsp 수정
### 2) Mapper 수정

## 3. update
## 4. delete
### 1) 


